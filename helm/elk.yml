apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: elk
  namespace: flux-system
spec:
  targetNamespace: elk
  interval: 24h
  timeout: 10m
  releaseName: elk
  chart:
    spec:
      sourceRef:
        kind: HelmRepository
        name: bitnami
        namespace: flux-system
      chart: elasticsearch
  install:
    createNamespace: true
    remediation:
      retries: 3
  upgrade:
    remediation:
      retries: 3
  values:
    global:
      kibanaEnabled: true
    security:
      enabled: false
      # PASSWORD must be the same value passed to elasticsearch to get an "out of the box" experience
      elasticPassword: "<PASSWORD>"
      tls:
        # AutoGenerate TLS certs for elastic
        autoGenerated: true
    kibana:
      elasticsearch:
        security:
          auth:
            enabled: false
            # default in the elasticsearch chart is elastic
            kibanaUsername: "<USERNAME>"
            kibanaPassword: "<PASSWORD>"
          tls:
            # Instruct kibana to connect to elastic over https
            enabled: false
            # Bit of a catch 22, as you will need to know the name upfront of your release
            existingSecret: RELEASENAME-elasticsearch-coordinating-crt # or just 'elasticsearch-coordinating-crt' if the release name happens to be 'elasticsearch'
            # As the certs are auto-generated, they are pemCerts so set to true
            usePemCerts: true
    master:
      masterOnly: false
      replicaCount: 1
    data:
      replicaCount: 0
    coordinating:
      replicaCount: 0
    ingest:
      replicaCount: 0